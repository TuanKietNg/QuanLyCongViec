"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("vue");const r=e=>{let r=null;let t=e.toString().match(/\(([a-z0-9 ,$_\+\*\-\/]+)\)/im);if(t&&Array.isArray(t)&&t[0]){let e=t[0];e=e.replace(/\(|\)|[ ]/g,"");let i=e.split(",");i.length>0&&(r=i)}return r},t=e=>"string"!=typeof e?"":e.charAt(0).toUpperCase()+e.slice(1),i=e.reactive({registeredUser:{},registeredRules:{},options:{}}),o=e=>{f(e.user)?i.registeredUser=e.user():i.registeredUser=e.user,e.rules&&"function"==typeof e.rules&&e.rules(),i.options=e},s=(e,r)=>{i.registeredRules.hasOwnProperty(e)?console.warn(`:::VueSimpleACL::: Duplicate ACL Rule '${e}' defined. Only the first defined rule will be evaluated.`):i.registeredRules[e]=r},a=(e,r)=>{"string"==typeof e?s(e,r):"object"==typeof e&&Array.isArray(e)&&Object.values(e).forEach((e=>{s(e,r)}))},n=(e,t,o)=>{try{return"function"==typeof e&&("object"!=typeof o||Array.isArray(o)?"object"==typeof o&&Array.isArray(o)?e(i.registeredUser,...o):e(i.registeredUser):e(i.registeredUser,o))}catch(i){let o=r(e),s=null;o&&Array.isArray(o)&&(o.shift(),s=o.join(", "));let a=':::VueSimpleACL::: The defined ACL Rule for "'+t+'" require some argument(s) or data object to be specified for matching.';return a+="\n\nCheck the file containing your defineAclRules((setRule) => {...}); declarations",a+="\n\nExamples:",o&&o.length<=0?(a+=`\nv-can:${t}`,a+=`\nv-can="'${t}'"`,a+=`\n$can('${t}')`):o&&1===o.length?(a+=`\nv-can:${t}="${s}"`,a+=`\nv-can="'${t}', ${s}"`,a+=`\n$can('${t}', ${s})`):(a+=`\nv-can:${t}="[${s}]"`,a+=`\nv-can="'${t}', [${s}]"`,a+=`\n$can('${t}', [${s}])`),console.error(a),console.error(i),!1}},l=({abilities:e,args:r,any:t=!1})=>{if(e&&"string"==typeof e){if(i.registeredRules.hasOwnProperty(e)){let t=i.registeredRules[e];return n(t,e,r)}}else if("object"==typeof e&&Array.isArray(e)){let r=!1,o=!1,s=0,a=0;return e.forEach((e=>{if(i.registeredRules.hasOwnProperty(e.abilities)){let l=i.registeredRules[e.abilities];o=n(l,e.abilities,e.args),a&&a++,!0===t&&o&&(r=!0),s++}})),s>0&&s===a&&(r=!0),r}return!1},c=({abilities:e,args:r,any:t=!1})=>{const i=r,o=t;let s=!1;if(e)s=l(i?{abilities:e,args:i}:{abilities:e});else if(i&&"string"==typeof i)s=l({abilities:i});else if(i&&null!==i&&"object"==typeof i){if(2!==(Array.isArray(i)?i.length:Object.keys(i).length)||"string"!=typeof i[0]||"object"!=typeof i[1]||Array.isArray(i[1])){let e=[],r=[];i.forEach((r=>{if(r&&"string"==typeof r)e.push({abilities:r});else if(r&&"object"==typeof r){let t=null,i=[];r.forEach((e=>{e&&!t&&"string"==typeof e?t=e:i.push(e)})),t&&e.push({abilities:t,args:i})}})),s=l({abilities:e,args:r,any:o})}else s=l({abilities:i[0],args:i[1]})}return s},p=({abilities:e,args:r,any:t=!1})=>e&&"string"==typeof e?c({abilities:e,args:r,any:t}):"object"==typeof e?c({abilities:null,args:e,any:t}):(console.warn(":::VueSimpleACL::: Invalid ACL arguments specified."),!1),m=(e,r)=>p({abilities:e,args:r,any:!1}),y=(e,r)=>!p({abilities:e,args:r,any:!1}),u=(e,r)=>p({abilities:e,args:r,any:!0}),f=e=>"function"==typeof e&&e()instanceof Promise,g=(s,a)=>{const n=!!s.config.globalProperties,l={...{user:Object.create(null),rules:null,router:null,onDeniedRoute:"/",directiveName:"can",helperName:"$can",enableSematicAlias:!0},...a};l.directiveName&&"string"==typeof l.directiveName&&l.directiveName.startsWith("v-")&&(l.directiveName=l.directiveName.substr(2,l.directiveName.length)),l.helperName&&"string"==typeof l.helperName&&"$"!==l.helperName.charAt(0)&&(l.helperName="$"+l.helperName),f(l.user)||o(l);const p=(e,r,t)=>{const i=r.arg,o=r.value,s=r.modifiers,a=!!s.any,n=!!s.not,l=!!s.readonly,p=!(!s.disable&&!s.disabled);!s.hide&&s.hidden;c({abilities:i,args:o,any:a})?n&&(e.style.display="none"):n||(p?e.disabled=!0:l?e.readOnly=!0:e.style.display="none")},g=(e,r,t)=>{e.directive(`${r}`,{mounted(e,r,t){p(e,r)},updated(e,r,t){p(e,r)}})},d=(e,r,i,o)=>{i?o?(e.config.globalProperties.$acl||(e.config.globalProperties.$acl={}),e.config.globalProperties.$acl[r]=(e,r)=>m(e,r),e.config.globalProperties.$acl[`all${t(r)}`]=(e,r)=>m(e,r),e.config.globalProperties.$acl[`not${t(r)}`]=(e,r)=>y(e,r),e.config.globalProperties.$acl[`any${t(r)}`]=(e,r)=>u(e,r)):(e.config.globalProperties[r]=(e,r)=>m(e,r),e.config.globalProperties[r].all=(e,r)=>m(e,r),e.config.globalProperties[r].not=(e,r)=>y(e,r),e.config.globalProperties[r].any=(e,r)=>u(e,r)):o?(e.prototype.$acl||(e.prototype.$acl={}),e.prototype.$acl[r]=(e,r)=>m(e,r),e.prototype.$acl[`all${t(r)}`]=(e,r)=>m(e,r),e.prototype.$acl[`not${t(r)}`]=(e,r)=>y(e,r),e.prototype.$acl[`any${t(r)}`]=(e,r)=>u(e,r)):(e.prototype[r]=(e,r)=>m(e,r),e.prototype[r].all=(e,r)=>m(e,r),e.prototype[r].not=(e,r)=>y(e,r),e.prototype[r].any=(e,r)=>u(e,r))};if(g(s,`${l.directiveName}`),l.enableSematicAlias&&(g(s,"permission"),g(s,"permissions"),g(s,"role"),g(s,"roles"),g(s,"role-or-permission"),g(s,"role-or-permissions")),d(s,`${l.helperName}`,n,!1),l.enableSematicAlias&&(d(s,"can",n,!0),d(s,"permission",n,!0),d(s,"permissions",n,!0),d(s,"role",n,!0),d(s,"roles",n,!0),d(s,"roleOrPermission",n,!0),d(s,"roleOrPermissions",n,!0),n?(s.config.globalProperties.$acl||(s.config.globalProperties.$acl={}),s.config.globalProperties.$acl.user=e.computed((()=>i.registeredUser)).value,s.config.globalProperties.$acl.getUser=()=>i.registeredUser):(s.prototype.$acl||(s.prototype.$acl={}),s.prototype.$acl.user=e.computed((()=>i.registeredUser)).value,s.prototype.$acl.getUser=()=>i.registeredUser)),l.router){const e=(e,r,t,i)=>{if(i)t();else{let i=l.onDeniedRoute;e.meta&&e.meta.onDeniedRoute&&(i=e.meta.onDeniedRoute),t("object"==typeof i?i:"$from"===i?r:{path:`${i}`,replace:!0})}},t=(t,o,s)=>{if(t.meta&&(t.meta.can||t.meta.permission||t.meta.role||t.meta.roleOrPermission)){const a=t.meta.can||t.meta.permission||t.meta.role||t.meta.roleOrPermission;let n=!1;if("function"==typeof a){const e=r(a);n=Array.isArray(e)&&4===e.length?a(t,o,m,i.registeredUser):a(t,o,m)}else n=m(a);e(t,o,s,n)}else if(t.meta&&(t.meta.canAll||t.meta.allCan||t.meta.allPermission||t.meta.allRole||t.meta.allRoleOrPermission)){const a=t.meta.canAll||t.meta.allCan||t.meta.allPermission||t.meta.allRole||t.meta.allRoleOrPermission;let n=!1;if("function"==typeof a){const e=r(a);n=Array.isArray(e)&&4===e.length?a(t,o,m,i.registeredUser):a(t,o,m)}else n=m(a);e(t,o,s,n)}else if(t.meta&&(t.meta.cannot||t.meta.canNot||t.meta.notCan||t.meta.notPermission||t.meta.notRole||t.meta.notRoleOrPermission)){const a=t.meta.cannot||t.meta.canNot||t.meta.notCan||t.meta.notPermission||t.meta.notRole||t.meta.notRoleOrPermission;let n=!1;if("function"==typeof a){const e=r(a);n=Array.isArray(e)&&4===e.length?a(t,o,y,i.registeredUser):a(t,o,y)}else n=y(a);e(t,o,s,n)}else if(t.meta&&(t.meta.canAny||t.meta.anyCan||t.meta.anyPermission||t.meta.anyRole||t.meta.anyRoleOrPermission)){const a=t.meta.canAny||t.meta.anyCan||t.meta.anyPermission||t.meta.anyRole||t.meta.anyRoleOrPermission;let n=!1;if("function"==typeof a){const e=r(a);n=Array.isArray(e)&&4===e.length?a(t,o,u,i.registeredUser):a(t,o,u)}else n=u(a);e(t,o,s,n)}else s()};l.router.beforeEach(((e,r,i)=>{f(l.user)?l.user().then((s=>{l.user=s,o(l),t(e,r,i)})).catch((e=>{console.warn(":::VueSimpleACL::: Error while processing/retrieving 'user' data with the Asynchronous function.")})):t(e,r,i)}))}else f(l.user)&&console.error(":::VueSimpleACL::: Instance of vue-router is required to define 'user' retrieved from a promise or Asynchronous function.")},d={install:(e,r)=>g(e,r)};"undefined"!=typeof window&&window.Vue&&window.Vue.use(d),exports.createAcl=e=>({install:(r,t={})=>{g(r,{...t,...e})}}),exports.defineAclRules=e=>{"function"==typeof e&&e(a)},exports.useAcl=()=>{let r={};return r.user=e.computed((()=>i.registeredUser)).value,r.getUser=()=>i.registeredUser,r.can=m,r.can.not=y,r.can.any=u,r.notCan=y,r.canNot=y,r.cannot=y,r.anyCan=u,r.permission=m,r.allPermission=m,r.notPermission=y,r.anyPermission=u,r.permission.not=y,r.permission.any=u,r.role=m,r.allRole=m,r.notRole=y,r.anyRole=u,r.role.not=y,r.role.any=u,r.roleOrPermission=m,r.allRoleOrPermission=m,r.notRoleOrPermission=y,r.anyRoleOrPermission=u,r.roleOrPermission.not=y,r.roleOrPermission.any=u,e.reactive(r)};
