{"remainingRequest":"D:\\TTTN2023\\Code\\QuanLyCongViec\\FE\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\TTTN2023\\Code\\QuanLyCongViec\\FE\\src\\pages\\tracuu\\index.vue?vue&type=style&index=0&id=0f03acc7&lang=css&","dependencies":[{"path":"D:\\TTTN2023\\Code\\QuanLyCongViec\\FE\\src\\pages\\tracuu\\index.vue","mtime":1704440180000},{"path":"D:\\TTTN2023\\Code\\QuanLyCongViec\\FE\\node_modules\\css-loader\\dist\\cjs.js","mtime":1704332100000},{"path":"D:\\TTTN2023\\Code\\QuanLyCongViec\\FE\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1704440418000},{"path":"D:\\TTTN2023\\Code\\QuanLyCongViec\\FE\\node_modules\\postcss-loader\\src\\index.js","mtime":1704332100000},{"path":"D:\\TTTN2023\\Code\\QuanLyCongViec\\FE\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1704332086000},{"path":"D:\\TTTN2023\\Code\\QuanLyCongViec\\FE\\node_modules\\vue-loader\\lib\\index.js","mtime":1704440418000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoNCi5tb2RhbC1kaWFsb2cgew0KICBtYXgtd2lkdGg6IDk3JTsNCiAgaGVpZ2h0OiAxMDB2aDsNCiAgZGlzcGxheTogZmxleDsNCn0NCg0KLnRhYmxlLWN1c3RvbS1zcm9sbGJhci1kdA0Kew0KICBoZWlnaHQ6IDQ2MHB4Ow0KICBiYWNrZ3JvdW5kOiAjZmZmZmZmOw0KICB3aWR0aDogMTAwJTsNCiAgb3ZlcmZsb3c6IGF1dG87DQp9DQoNCg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;AAwlDA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/tracuu","sourcesContent":["<script>\r\nimport Layout from \"../../layouts/main\";\r\nimport PageHeader from \"@/components/page-header\";\r\nimport DatePicker from \"vue2-datepicker\";\r\nimport appConfig from \"@/app.config\";\r\nimport {pagingModel} from \"@/models/pagingModel\";\r\nimport Multiselect from \"vue-multiselect\";\r\nimport {VMoney} from 'v-money'\r\nimport {hoaDonModel} from \"@/models/hoaDonModel\";\r\nimport {thongTinHangHoaModel} from \"@/models/thongTinHangHoaModel\";\r\nimport {required} from \"vuelidate/lib/validators\";\r\nimport {deleteModel} from \"@/models/deleteModel\";\r\nimport {formatNumber} from \"@/models/formatNumberModel\";\r\nimport {khachHangModel} from \"@/models/khachHangModel\";\r\nimport Switches from \"vue-switches\";\r\nexport default {\r\n  computed: {\r\n    formatNumber() {\r\n      return formatNumber\r\n    }\r\n  },\r\n  page: {\r\n    title: \"TRA CỨU HOÁ ĐƠN\",\r\n    meta: [{name: \"description\", content: appConfig.description}],\r\n  },\r\n  // eslint-disable-next-line vue/no-unused-components\r\n  components: {Multiselect, Layout, PageHeader, DatePicker,VMoney},\r\n  directives: {money: VMoney},\r\n  data() {\r\n    return {\r\n      title: \"TRA CỨU HOÁ ĐƠN\",\r\n      items: [\r\n        {\r\n          text: \"TRA CỨU HOÁ ĐƠN\",\r\n          href: '/tra-cuu',\r\n        },\r\n        {\r\n          text: \"Danh sách\",\r\n          active: true,\r\n        }\r\n      ],\r\n      data: [],\r\n      fields: [\r\n        {\r\n          key: 'STT',\r\n          label: 'STT',\r\n          class: 'td-5',\r\n          thClass: 'hidden-sortable'\r\n        },\r\n        {\r\n          key: \"createdAtShow\",\r\n          label: \"Ngày phát hành\",\r\n          class: 'td-10',\r\n          thClass: 'hidden-sortable'\r\n        },\r\n        {\r\n          key: \"fullName\",\r\n          label: \"Nhân viên phát hành\",\r\n          class: 'td-20',\r\n          thClass: 'hidden-sortable'\r\n        },\r\n        {\r\n          key: \"tenKhachHang\",\r\n          label: \"Tên khách hàng\",\r\n          class: 'td-20',\r\n          thClass: 'hidden-sortable'\r\n        },\r\n        {\r\n          key: \"invoiceNo\",\r\n          label: \"Số hoá đơn\",\r\n          class: 'td-15',\r\n          thClass: 'hidden-sortable'\r\n        },\r\n        {\r\n          key: \"maSoThue\",\r\n          label: \"Mã số thuế\",\r\n          class: 'td-15',\r\n          thClass: 'hidden-sortable'\r\n        },\r\n        {\r\n          key: \"chuyenDoi\",\r\n          label: \"Chuyển đổi\",\r\n          class: 'td-8',\r\n          thClass: 'hidden-sortable'\r\n        },\r\n        {\r\n          key: \"tongTienShow\",\r\n          label: \"Tổng tiền\",\r\n          class: 'td-10',\r\n          thClass: 'hidden-sortable'\r\n        },\r\n        {\r\n          key: \"statusName\",\r\n          label: \"Trạng thái\",\r\n          class: 'td-15',\r\n          thClass: 'hidden-sortable'\r\n        },\r\n        {\r\n          key: 'process',\r\n          label: '',\r\n          class: 'td-15',\r\n          thClass: 'hidden-sortable'\r\n        }\r\n      ],\r\n      fieldsModal: [\r\n        {\r\n          key: \"tenHangHoa\",\r\n          label: \"Tên hàng hoá\",\r\n          class: 'td-username',\r\n          thStyle: \"text-align:center\",\r\n          thClass: 'hidden-sortable'\r\n        },\r\n        {\r\n          key: \"donGia\",\r\n          label: \"Đơn giá\",\r\n          class: 'td-15',\r\n          thClass: 'hidden-sortable'\r\n        },\r\n        {\r\n          key: \"soLuong\",\r\n          label: \"Số lượng\",\r\n          class: 'td-15',\r\n          thClass: 'hidden-sortable'\r\n        },\r\n        {\r\n          key: \"donViTinh\",\r\n          label: \"Đơn vị tính\",\r\n          class: 'td-20',\r\n          thClass: 'hidden-sortable'\r\n        },\r\n\r\n        {\r\n          key: 'process',\r\n          label: '',\r\n          class: \"td-5\",\r\n          thClass: 'hidden-sortable'\r\n        }\r\n      ],\r\n      money: {\r\n        decimal: \",\",\r\n        thousands: \".\",\r\n        prefix: \"\",\r\n        suffix: \"\",\r\n        precision: 0,\r\n        masked: false,\r\n      },\r\n      currentPage: 1,\r\n      pageOptions: [5, 10, 25, 50, 100],\r\n      showModal: false,\r\n      showDeleteModal: false,\r\n      showDeleteModalNhap: false,\r\n      showDeleteTableModal: false,\r\n      submitted: false,\r\n      isUpdate : false,\r\n      isUpdateList : false,\r\n      submittedPH: false,\r\n      showPhatHanhModal: false,\r\n      submittedHuy: false,\r\n      sortBy: \"age\",\r\n      filter: null,\r\n      sortDesc: false,\r\n      isShow : false,\r\n      filterOn: [],\r\n      isDelete : true,\r\n      numberOfElement: 1,\r\n      totalRows: 1,\r\n      perPage : 10,\r\n      stt: 20,\r\n      valueLoaiDichVuYTe: null,\r\n      valueThuoc : null,\r\n      valueDonViTinh : null,\r\n      model: hoaDonModel.baseJson(),\r\n      huyModel : deleteModel.baseJson(),\r\n      modelThongTin: thongTinHangHoaModel.baseJson(),\r\n      list: [],\r\n      listKhachHang:[],\r\n      tongTien : 0 ,\r\n      giamGia : 0 ,\r\n      listHinhThuc: [],\r\n      listLoaiDichVu: [],\r\n      isSend : true,\r\n      listThuoc : [],\r\n      listDonViTinh : [],\r\n      valueKhachHang:null,\r\n      pagination: pagingModel.baseJson(),\r\n      itemFilter: {\r\n        hinhThucThanhToan : null,\r\n        ngayBatDau:new Date(this.getCurrentDateFormatted()),\r\n        ngayKetThuc:new Date(this.getCurrentDateFormatted()),\r\n        content:null,\r\n        userName:null,\r\n        trangThai:\"ALL\"\r\n      },\r\n      isCollapseSearch: false,\r\n      listNguoiPhatHanh:[],\r\n      listTrangThai:[\r\n        {\r\n          code:\"ALL\",\r\n          name:\"CHỌN TẤT CẢ\"\r\n        },\r\n        {\r\n          code:\"NHAP\",\r\n          name:\"Hóa đơn nháp\"\r\n        },\r\n        {\r\n          code:\"DAPHATHANH\",\r\n          name:\"Hóa đơn đã phát hành\"\r\n        },\r\n        {\r\n          code:\"THAYTHE\",\r\n          name:\"Hóa đơn thay thế\"\r\n        },\r\n        {\r\n          code:\"DAXOA\",\r\n          name:\"Hóa đơn đã xóa\"\r\n        }\r\n      ]\r\n    };\r\n  },\r\n  created() {\r\n    console.log(\"LOG : \", )\r\n    this.getListHinhThuc();\r\n    this.getListLoaiDichVu();\r\n    this.getListNguoiPhatHanh()\r\n  },\r\n  validations: {\r\n    huyModel : {\r\n      vanban: {required},\r\n      lydo: {required}\r\n    },\r\n    model: {\r\n      hinhThucThanhToan : {required},\r\n      tenKhachHang: {required},\r\n      diaChi: {required}\r\n    },\r\n    modelThongTin : {\r\n      tenHangHoa: {required},\r\n    },\r\n    valueDonViTinh : {required},\r\n    valueThuoc : {required},\r\n    valueLoaiDichVuYTe : {required}\r\n\r\n\r\n  },\r\n  methods: {\r\n    normalizer(node) {\r\n      if (node.children == null || node.children == 'null') {\r\n        delete node.children;\r\n      }\r\n    },\r\n    async getListDonViTinh() {\r\n      await this.$store.dispatch(\"commonStore/getAll\", \"DM_DONVITINH\").then((res) => {\r\n        this.listDonViTinh = res.data || [];\r\n\r\n      })\r\n    },\r\n    async getListKhachHang() {\r\n      await this.$store.dispatch(\"khachHangStore/getAll\").then((res) => {\r\n        console.log(\"LOG khach hang : \", res.data)\r\n        this.listKhachHang = res.data || [];\r\n      })\r\n    },\r\n    async getListNguoiPhatHanh() {\r\n      await this.$store.dispatch(\"userStore/getAll\").then((res) => {\r\n        this.listNguoiPhatHanh = res.data || [];\r\n        this.itemFilter.userName = this.listNguoiPhatHanh.at(0);\r\n      })\r\n    },\r\n    async getListHinhThuc() {\r\n      await this.$store.dispatch(\"commonStore/getAll\", \"DM_HINHTHUCTHANHTOAN\").then((res) => {\r\n        this.listHinhThuc = res.data || [];\r\n      })\r\n    },\r\n    async getListLoaiDichVu() {\r\n      await this.$store.dispatch(\"loaiDichVuYTeStore/getAll\").then((res) => {\r\n        console.log(\"LOG LOAI DICH VU : \", res.data)\r\n        this.listLoaiDichVu = res.data || [];\r\n      })\r\n    },\r\n    async fnGetList() {\r\n      this.$refs.tblList?.refresh()\r\n    },\r\n    async handleClose() {\r\n      this.showDeleteTableModal = false ;\r\n      this.valueDonViTinh = null;\r\n      this.valueThuoc = null;\r\n      this.valueLoaiDichVuYTe = null;\r\n      this.modelThongTin = thongTinHangHoaModel.baseJson();\r\n    },\r\n    handleSearch() {\r\n      this.itemFilter.isSearch = true\r\n      this.$refs.tblList.refresh();\r\n    },\r\n    handleClear(){\r\n      this.itemFilter.hinhThucThanhToan=null,\r\n          this.itemFilter.ngayBatDau=new Date(this.getCurrentDateFormatted()),\r\n          this.itemFilter.ngayKetThuc=new Date(this.getCurrentDateFormatted()),\r\n          this.itemFilter.content=null,\r\n          this.itemFilter.fill=null,\r\n          this.itemFilter.trangThai=\"ALL\",\r\n          this.itemFilter.userName=null\r\n\r\n    },\r\n    async handleModalClose() {\r\n      this.showModal =false;\r\n      this.isUpdate =false;\r\n      this.handleBaseValue();\r\n    },\r\n\r\n\r\n\r\n\r\n    async handleUpdateList(item) {\r\n      this.isUpdateList = true;\r\n      this.valueLoaiDichVuYTe = item.loaiDichVuYTe;\r\n      console.log(\"LOG BEFORE : \", this.isUpdateList)\r\n      this.modelThongTin = item ;\r\n      this.valueDonViTinh = item.donViTinh ;\r\n      this.valueThuoc = item.thuoc;\r\n\r\n\r\n    },\r\n    async handleUpdate(id) {\r\n      this.getListDonViTinh();\r\n      this.getListKhachHang();\r\n      await this.$store.dispatch(\"hoaDonStore/getById\", id).then((res) => {\r\n        if (res.code===0) {\r\n          console.log(res)\r\n          this.model = hoaDonModel.toJson(res.data);\r\n          this.list = this.model.list;\r\n          this.tongTien = this.model.tongTien;\r\n          this.$refs.tblList?.refresh()\r\n          this.isUpdate = true;\r\n          this.showModal = true;\r\n        } else {\r\n          this.$store.dispatch(\"snackBarStore/addNotify\", {\r\n            message: res.message,\r\n            code: res.code,\r\n          });\r\n        }\r\n      });\r\n    },\r\n\r\n\r\n    async handleConversionInvoice(id) {\r\n      await this.$store.dispatch(\"hoaDonStore/SendConversionInvoice\", id).then((res) => {\r\n          if (res.data != null)\r\n          {\r\n            var blob = new Blob([this.base64ToArrayBuffer(res.data)], {type: \"application/pdf\"});\r\n            var link = document.createElement('a');\r\n            link.href = window.URL.createObjectURL(blob);\r\n            var name = \"hoadon\";\r\n            link.download = name;\r\n            link.click();\r\n            this.$refs.tblList.refresh();\r\n          }\r\n          this.$store.dispatch(\"snackBarStore/addNotify\", {\r\n            message: res.message,\r\n            code: res.code,\r\n          });\r\n      });\r\n    },\r\n    async handleSendInvoiceFromData(value) {\r\n        this.model = value;\r\n        this.showPhatHanhModal = true;\r\n    },\r\n    async handleClosePhatHanh() {\r\n      this.showPhatHanhModal = false ;\r\n      this.model = hoaDonModel.baseJson();\r\n    },\r\n\r\n    async handleSendInvoiceFromDataAPI() {\r\n      if (\r\n          this.model.id != null\r\n      ) {\r\n        let loader = this.$loading.show({\r\n          container: this.$refs.formContainer,\r\n        });\r\n        this.isSend = false;\r\n        await this.$store.dispatch(\"hoaDonStore/SendInvoiceFromData\",this.model).then((res) => {\r\n          if (res.data != null)\r\n          {\r\n              this.showModal= false;\r\n              this.showPhatHanhModal = false;\r\n              this.$refs.tblList?.refresh()\r\n          }\r\n          this.$store.dispatch(\"snackBarStore/addNotify\", {\r\n            message: res.message,\r\n            code: res.code,\r\n          });\r\n        })\r\n        loader.hide();\r\n        this.isSend = true;\r\n\r\n      }\r\n    },\r\n\r\n    async handleDeleteModal() {\r\n   //   console.log(\"LOG XÓA HAND DELETED MODAL : \" , this.modelThongTin)\r\n      if (this.modelThongTin.ma != 0 && this.modelThongTin.ma != null) {\r\n        this.model.list = this.model.list.filter(x => {\r\n          if (x.ma != this.modelThongTin.ma)\r\n            return x;\r\n        })\r\n        if (this.modelThongTin.khongTru) {\r\n          this.isDeleteTinhPhi = true;\r\n        }\r\n        if (this.modelThongTin.ma != 0 && this.modelThongTin.ma != null) {\r\n          this.model.list = this.model.list.filter(x => {\r\n            if (x.ma != this.modelThongTin.ma) {\r\n              return x;\r\n            }\r\n          })\r\n          this.listThongTin = [];\r\n          this.tongTien = 0;\r\n          this.model.list.forEach((element) => {\r\n            //  console.log(\"LOG NGUYE NTUAN KIET \", this.model.list, element);\r\n            if (this.isDeleteTinhPhi && element.thuoc.duocGiamGia\r\n                && element.loaiDichVuYTe.code === \"09\") {\r\n              if (element.soLuong > 1) {\r\n    //            console.log(\"LOG SO LUONG > 1  \", this.isDeleteTinhPhi, formatNumber.FormatNumber(this.tongTien), element);\r\n                this.tongTien = formatNumber.FormatNumber(this.tongTien) + formatNumber.FormatNumber(element.donGia) + element.thuoc.soTienGiamLanHai;\r\n                this.listThongTin.push(thongTinHangHoaModel.sendJsonFirst(element, element.ma + 1, 1, formatNumber.FormatNumber(element.donGia) + element.thuoc.soTienGiamLanHai, true));\r\n                element.donGia = formatNumber.FormatNumber(element.donGia);\r\n                // console.log(\"LOG MODEL THONG TIN : \", this.tongTien,formatNumber.FormatNumber(this.modelThongTin.donGia) , this.modelThongTin.thuoc.soTienGiamLanHai)\r\n                this.tongTien = formatNumber.FormatNumber(this.tongTien) + (formatNumber.FormatNumber(element.donGia) * (element.soLuong - 1));\r\n                //      console.log(\"LOG MODEL THONG TIN 2: \",this.tongTien, formatNumber.FormatNumber(this.modelThongTin.donGia) , this.modelThongTin.soLuong-1)\r\n                this.listThongTin.push(thongTinHangHoaModel.sendJsonLeftSection(element));\r\n              } else {\r\n       //         console.log(\"LOG SO LUONG < 1 \", this.isDeleteTinhPhi, element.soLuong);\r\n                this.tongTien = formatNumber.FormatNumber(this.tongTien) + (formatNumber.FormatNumber(element.donGia) + element.thuoc.soTienGiamLanHai);\r\n                element.donGia = formatNumber.FormatNumber(element.donGia) + element.thuoc.soTienGiamLanHai;\r\n                element.khongTru = true;\r\n                this.listThongTin.push(thongTinHangHoaModel.sendJson(element));\r\n              }\r\n              this.isDeleteTinhPhi = false;\r\n            } else {\r\n         //     console.log(\"LOG BINH THUONG < 1 \", this.isDeleteTinhPhi, element.soLuong);\r\n              this.tongTien = formatNumber.FormatNumber(this.tongTien) + (formatNumber.FormatNumber(element.donGia));\r\n              element.donGia = formatNumber.FormatNumber(element.donGia);\r\n              this.listThongTin.push(thongTinHangHoaModel.sendJson(element));\r\n            }\r\n          });\r\n          this.model.list = this.listThongTin;\r\n          this.stt++;\r\n\r\n          this.showDeleteTableModal = false;\r\n          /*        this.tongTien = formatNumber.FormatNumber(this.tongTien) - (formatNumber.FormatNumber(this.modelThongTin.donGia)* this.modelThongTin.soLuong) ;\r\n        this.modelThongTin = thongTinHangHoaModel.baseJson();\r\n        this.showDeleteTableModal = false;*/\r\n        }\r\n      }\r\n    },\r\n\r\n    async handleSendReplacementInvoiceFromDataAPI() {\r\n      if (\r\n          this.model.id != null\r\n      ) {\r\n        let loader = this.$loading.show({\r\n          container: this.$refs.formContainer,\r\n        });\r\n        this.isSend = false;\r\n        await this.$store.dispatch(\"hoaDonStore/SendReplacementInvoiceFromData\",this.model).then((res) => {\r\n          if (res.data != null)\r\n          {\r\n            this.showPhatHanhModal = false;\r\n            this.showModal = false;\r\n            this.$refs.tblList?.refresh()\r\n          }\r\n          this.$store.dispatch(\"snackBarStore/addNotify\", {\r\n            message: res.message,\r\n            code: res.code,\r\n          });\r\n        })\r\n        loader.hide();\r\n        this.isSend = true;\r\n\r\n      }\r\n    },\r\n\r\n    async handleDelete(value) {\r\n      if (value.statusCode ===\"NHAP\")\r\n      {\r\n         this.showDeleteModalNhap = true;\r\n      }\r\n      else\r\n      {\r\n        this.showDeleteModal = true;\r\n      }\r\n\r\n      this.huyModel.id = value.id;\r\n    },\r\n    handleShowDeleteModalTable(value) {\r\n    /*  this.modelThongTin.ma = value.ma;\r\n      this.modelThongTin.soLuong = value.soLuong;\r\n      this.modelThongTin.donGia = value.donGia;\r\n      this.showDeleteTableModal = true;*/\r\n      this.isDeleteTinhPhi = false;\r\n      this.modelThongTin.ma = value.ma;\r\n      this.modelThongTin.soLuong = value.soLuong;\r\n      this.modelThongTin.donGia = value.donGia;\r\n      this.modelThongTin.khongTru = value.khongTru;\r\n      this.showDeleteTableModal = true;\r\n    },\r\n    async handleDeleteAPI() {\r\n      this.submittedHuy = true;\r\n //     console.log(\"LOG SUBMIT LIST  : \",this.model)\r\n      this.$v.$touch();\r\n      if (this.$v.huyModel.$invalid ) {\r\n  //      console.log(\"LOG INVALID  : \", this.$v)\r\n        return;\r\n      } else {\r\n        this.isDelete = false;\r\n        await this.$store.dispatch(\"hoaDonStore/delete\", this.huyModel).then((res) => {\r\n          if (res.data.code === 0) {\r\n            this.$refs.tblList?.refresh()\r\n            this.showDeleteModal = false;\r\n          }\r\n          this.$store.dispatch(\"snackBarStore/addNotify\", {\r\n            message: res.data.message,\r\n            code: res.data.code,\r\n          });\r\n        });\r\n      }\r\n      this.isDelete = true;\r\n    },\r\n\r\n    async handleDeleteNhapAPI() {\r\n      //  e.preventDefault();\r\n        this.isDelete = false;\r\n        await this.$store.dispatch(\"hoaDonStore/delete\", this.huyModel).then((res) => {\r\n    //      console.log(\"LOG RES \", res.data)\r\n          if (res.data.code === 0) {\r\n            // this.model = hoaDonModel.toJson(res.data);\r\n            // this.list = this.model.list;\r\n            this.$refs.tblList?.refresh()\r\n            // this.isUpdate = true;\r\n            // this.showModal = true;\r\n            this.showDeleteModalNhap = false;\r\n          }\r\n          this.$store.dispatch(\"snackBarStore/addNotify\", {\r\n            message: res.data.message,\r\n            code: res.data.code,\r\n          });\r\n        });\r\n      this.isDelete = true;\r\n    },\r\n    async handleBaseThongTin() {\r\n      this.modelThongTin = thongTinHangHoaModel.baseJson();\r\n      this.valueDonViTinh = null;\r\n      this.valueThuoc = null;\r\n      this.valueLoaiDichVuYTe = null;\r\n    },\r\n\r\n    formatPrice(value) {\r\n      return value.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\")\r\n    },\r\n    async handleInvoiceModal() {\r\n      if (\r\n          this.model.id != null\r\n      ) {\r\n        let loader = this.$loading.show({\r\n          container: this.$refs.formContainer,\r\n        });\r\n        await this.$store.dispatch(\"hoaDonStore/GetInvoiceDraftFromData\", this.model.id).then((res) => {\r\n          if (res.data != null)\r\n          {\r\n            var blob = new Blob([this.base64ToArrayBuffer(res.data)], {type: \"application/pdf\"});\r\n            var link = document.createElement('a');\r\n            link.href = window.URL.createObjectURL(blob);\r\n            var name = \"hoadon\";\r\n            link.download = name;\r\n            link.click();\r\n          }\r\n          this.$store.dispatch(\"snackBarStore/addNotify\", {\r\n            message: res.message,\r\n            code: res.code,\r\n          });\r\n        })\r\n        loader.hide();\r\n      }\r\n    },\r\n    async handleInvoiceFromData(id) {\r\n      let loader = this.$loading.show({\r\n        container: this.$refs.formContainer,\r\n      });\r\n   //   console.log(\"LOG INVOICE : \", id);\r\n\r\n      try {\r\n        const response = await this.$store.dispatch(\"hoaDonStore/GetInvoiceDraftFromData\", id);\r\n        if (response.data != null) {\r\n\r\n          await this.$store.dispatch(\"hoaDonStore/getFileViettel\",response.data).then((res) => {\r\n            if (res  == null || (res != null && res.fileToBytes == null))\r\n            {\r\n              this.$store.dispatch(\"snackBarStore/addNotify\", {\r\n                message: \"Tải file thất bại\",\r\n                code: 400,\r\n              });\r\n            }\r\n            var blob = new Blob([this.base64ToArrayBuffer(res.fileToBytes)], { type: \"application/pdf\" });\r\n            this.openAndPrintPDF(blob, \"hoadon.pdf\"); // Set the desired file name here\r\n          })\r\n\r\n\r\n      //     var blob = new Blob([this.base64ToArrayBuffer(response.data)], { type: \"application/pdf\" });\r\n      // //    var blob = new Blob([this.base64ToArrayBuffer(res.data)], {type: \"application/pdf\"});\r\n      //     var link = document.createElement('a');\r\n      //     link.href = window.URL.createObjectURL(blob);\r\n      //     var name = \"hoadon\";\r\n      //     link.download = name;\r\n      //     link.click();\r\n        }\r\n        this.$store.dispatch(\"snackBarStore/addNotify\", {\r\n          message: response.message,\r\n          code: response.code,\r\n        });\r\n      } catch (error) {\r\n        // Handle error here\r\n        console.error(\"Error fetching invoice data:\", error);\r\n      }\r\n\r\n      loader.hide();\r\n    },\r\n\r\n\r\n    async handleShowInvoiceFromData(id) {\r\n  //    console.log(\"LOG SHOW INVOICE : \", id);\r\n      let loader = this.$loading.show({\r\n        container: this.$refs.formContainer,\r\n      });\r\n//     console.log(\"LOG INVOICE : \", id);\r\n\r\n      try {\r\n        const response = await this.$store.dispatch(\"hoaDonStore/GetInvoiceDraftFromData\", id);\r\n        if (response.data != null) {\r\n          var blob = new Blob([this.base64ToArrayBuffer(response.data)], { type: \"application/pdf\" });\r\n          this.openAndPrintPDF(blob, \"hoadon.pdf\"); // Set the desired file name here\r\n        }\r\n        this.$store.dispatch(\"snackBarStore/addNotify\", {\r\n          message: response.message,\r\n          code: response.code,\r\n        });\r\n      } catch (error) {\r\n        // Handle error here\r\n        console.error(\"Error fetching invoice data:\", error);\r\n      }\r\n      loader.hide();\r\n    },\r\n\r\n    openAndPrintPDF(blob, fileName) {\r\n      // Create a new URL for the Blob object\r\n      const url = window.URL.createObjectURL(blob);\r\n\r\n      // Open a new window to display the PDF\r\n      const newWindow = window.open(url, \"_blank\");\r\n\r\n      // Check if the new window was opened successfully\r\n      if (newWindow) {\r\n        // Wait for the new window to finish loading the PDF\r\n        newWindow.onload = () => {\r\n          // Print the PDF\r\n          newWindow.print();\r\n        };\r\n      } else {\r\n        // Handle error if the new window couldn't be opened\r\n        console.error(\"Failed to open the PDF in a new window.\");\r\n      }\r\n\r\n      // Set the download attribute of a temporary anchor element to trigger the download\r\n      // const link = document.createElement(\"a\");\r\n      // link.href = url;\r\n      // link.download = fileName;\r\n      // link.style.display = \"none\";\r\n      // document.body.appendChild(link);\r\n      // link.click();\r\n      // document.body.removeChild(link);\r\n    },\r\n\r\n\r\n    base64ToArrayBuffer(base64)\r\n    {\r\n      var binaryString = window.atob(base64);\r\n      var binaryLen = binaryString.length;\r\n      var bytes = new Uint8Array(binaryLen);\r\n      for (var i = 0; i < binaryLen; i++) {\r\n        var ascii = binaryString.charCodeAt(i);\r\n        bytes[i] = ascii;\r\n      }\r\n      return bytes;\r\n    },\r\n    myProvider(ctx) {\r\n      const params = {\r\n        start: ctx.currentPage,\r\n        limit: ctx.perPage,\r\n        content: this.filter,\r\n        sortBy: ctx.sortBy,\r\n        sortDesc: ctx.sortDesc,\r\n        hinhThucThanhToan:this.itemFilter.hinhThucThanhToan,\r\n        startDate: this.itemFilter.ngayBatDau\r\n            ? new Date(this.itemFilter.ngayBatDau)\r\n            : null,\r\n        endDate:this.itemFilter.ngayKetThuc\r\n            ? new Date(this.itemFilter.ngayKetThuc)\r\n            : null,\r\n        contentFill:this.itemFilter.content,\r\n        userName:this.itemFilter.userName,\r\n        fill:this.itemFilter.fill,\r\n        trangThai:this.itemFilter.trangThai\r\n      }\r\n      this.loading = true\r\n      try {\r\n        let promise = this.$store.dispatch(\"hoaDonStore/getSearchPagingParams\", params)\r\n        return promise.then(resp => {\r\n          let items = resp.data.data\r\n          this.totalRows = resp.data.totalRows\r\n          this.numberOfElement = resp.data.data.length\r\n          this.loading = false\r\n          return items || []\r\n        })\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n    getCurrentDateFormatted() {\r\n      const currentDate = new Date();\r\n      const day = String(currentDate.getDate()).padStart(2, '0');\r\n      const month = String(currentDate.getMonth() + 1).padStart(2, '0');\r\n      const year = currentDate.getFullYear();\r\n      return `${month},${day},${year}`;\r\n    },\r\n    async handleBaseValue() {\r\n      this.list = [];\r\n      this.model = hoaDonModel.baseJson();\r\n      this.model.hinhThucThanhToan =  this.listHinhThuc.at(0);\r\n      this.valueKhachHang = null;\r\n      this.valueDonViTinh = null;\r\n      this.valueThuoc = null;\r\n      this.valueLoaiDichVuYTe = null\r\n    },\r\n    async handleSubmitList(e) {\r\n    //  console.log(\"LOG HANDLED SUBMITE LIST \")\r\n      e.preventDefault();\r\n      this.submitted = true;\r\n      this.$v.$touch();\r\n        if (this.$v.modelThongTin.$invalid || this.model.list == 0)\r\n        {\r\n          this.$store.dispatch(\"snackBarStore/addNotify\", {\r\n            message: \"Thông tin khách hàng và danh sách hàng hóa không được bỏ trống\",\r\n            code: 20,\r\n          });\r\n        return;\r\n      } else {\r\n  //           console.log(\"LOG ELE BASE : \", this.modelThongTin.ma)\r\n          this.modelThongTin.ma = this.stt;\r\n          this.modelThongTin.loaiDichVuYTe = this.valueLoaiDichVuYTe;\r\n          this.modelThongTin.thuoc =  this.valueThuoc;\r\n          this.modelThongTin.donViTinh = this.valueDonViTinh;\r\n          if (this.model.list.length == 0 && this.modelThongTin.thuoc.duocGiamGia\r\n              && this.modelThongTin.loaiDichVuYTe.code ===\"09\")\r\n          {\r\n            //   console.log(\"LOG 1 : \")\r\n            if (this.modelThongTin.soLuong > 1)\r\n            {\r\n//              console.log(\"LOG THONG TIN SO LUONG: \", this.modelThongTin.ma)\r\n              this.tongTien = formatNumber.FormatNumber(this.tongTien) + (formatNumber.FormatNumber(this.modelThongTin.donGia)) ;\r\n              this.model.list.push(thongTinHangHoaModel.sendJsonFirst(this.modelThongTin,this.modelThongTin.ma + 20,1,this.modelThongTin.donGia, true));\r\n              this.modelThongTin.donGia = formatNumber.FormatNumber(this.modelThongTin.donGia) - this.modelThongTin.thuoc.soTienGiamLanHai;\r\n              // console.log(\"LOG MODEL THONG TIN : \", this.tongTien,formatNumber.FormatNumber(this.modelThongTin.donGia) , this.modelThongTin.thuoc.soTienGiamLanHai)\r\n              this.tongTien = formatNumber.FormatNumber(this.tongTien) + (formatNumber.FormatNumber(this.modelThongTin.donGia) * (this.modelThongTin.soLuong-1));\r\n              //      console.log(\"LOG MODEL THONG TIN 2: \",this.tongTien, formatNumber.FormatNumber(this.modelThongTin.donGia) , this.modelThongTin.soLuong-1)\r\n              this.model.list.push(thongTinHangHoaModel.sendJsonLeftSection(this.modelThongTin));\r\n            }else {\r\n              this.tongTien = formatNumber.FormatNumber(this.tongTien) + (formatNumber.FormatNumber(this.modelThongTin.donGia)) ;\r\n              this.modelThongTin.donGia = formatNumber.FormatNumber(this.modelThongTin.donGia);\r\n              this.model.list.push(thongTinHangHoaModel.sendJson(this.modelThongTin));\r\n            }\r\n          }\r\n          else if (this.model.list.length > 0 && this.modelThongTin.thuoc.duocGiamGia\r\n              && this.modelThongTin.loaiDichVuYTe.code ===\"09\") {\r\n            //      console.log(\"LOG 2 :\", this.model.list )\r\n            this.model.list.filter(x => {\r\n              if (x.loaiDichVuYTe.code === \"09\" && x.thuoc.duocGiamGia) {\r\n                this.giamGia = this.modelThongTin.thuoc.soTienGiamLanHai;\r\n              }\r\n            })\r\n            if (this.giamGia === 0) {\r\n   //                 console.log(\" GIAM GIA === 0 , \" ,this.giamGia)\r\n              this.tongTien = formatNumber.FormatNumber(this.tongTien) + (formatNumber.FormatNumber(this.modelThongTin.donGia));\r\n              this.model.list.push(thongTinHangHoaModel.sendJsonFirst(this.modelThongTin, this.modelThongTin.ma + 20,  1, this.modelThongTin.donGia,true));\r\n              this.modelThongTin.donGia = formatNumber.FormatNumber(this.modelThongTin.donGia) - this.modelThongTin.thuoc.soTienGiamLanHai;\r\n //                   console.log(\"LOG MODEL THONG TIN : \", this.tongTien, formatNumber.FormatNumber(this.modelThongTin.donGia), this.modelThongTin.thuoc.soTienGiamLanHai)\r\n              this.tongTien = formatNumber.FormatNumber(this.tongTien) + (formatNumber.FormatNumber(this.modelThongTin.donGia) * (this.modelThongTin.soLuong - 1));\r\n //                   console.log(\"LOG MODEL THONG TIN 2: \", this.tongTien, formatNumber.FormatNumber(this.modelThongTin.donGia), this.modelThongTin.soLuong - 1)\r\n              this.model.list.push(thongTinHangHoaModel.sendJsonLeftSection(this.modelThongTin));\r\n            } else {\r\n //                  console.log(\" GIAM CÓ GIAM GIA   , \" ,this.tongTien , )\r\n              this.modelThongTin.donGia = formatNumber.FormatNumber(this.modelThongTin.donGia) - this.giamGia;\r\n              this.tongTien = formatNumber.FormatNumber(this.tongTien) + (formatNumber.FormatNumber(this.modelThongTin.donGia) * this.modelThongTin.soLuong);\r\n              //      console.log(\" SAU KHI GIAM CÓ GIAM GIA   , \" ,this.tongTien ,formatNumber.FormatNumber(this.modelThongTin.donGia) , this.modelThongTin.soLuong )\r\n              this.model.list.push(thongTinHangHoaModel.sendJson(this.modelThongTin));\r\n            }\r\n          }else {\r\n  //                console.log(\"LOG LIST BREAK \")\r\n            this.modelThongTin.donGia = formatNumber.FormatNumber(this.modelThongTin.donGia);\r\n            this.model.list.push(thongTinHangHoaModel.sendJson(this.modelThongTin));\r\n            this.tongTien = formatNumber.FormatNumber(this.tongTien) + (formatNumber.FormatNumber(this.modelThongTin.donGia)* this.modelThongTin.soLuong) ;\r\n          }\r\n          this.stt++;\r\n          this.valueThuoc = null;\r\n          this.valueLoaiDichVuYTe =null ;\r\n          this.valueDonViTinh = null ;\r\n          this.modelThongTin = thongTinHangHoaModel.baseJson();\r\n          this.giamGia = 0;\r\n          this.loading = false;\r\n          this.$refs.tblListTable?.refresh()\r\n//          console.log(\"LOG LIST : \", this.model.list)\r\n      }\r\n    },\r\n    disabledEndDate(date) {\r\n      return this.itemFilter.ngayBatDau && date.setHours(0, 0, 0, 0) < new Date(this.itemFilter.ngayBatDau).setHours(0, 0, 0, 0);\r\n    },\r\n    disabledEndTime(date) {\r\n      return this.itemFilter.ngayBatDau && date < this.itemFilter.ngayBatDau;\r\n    },\r\n    filterNonNumeric(event) {\r\n      const inputValue = event.target.value;\r\n      const numericRegex = /^[0-9]+$/;\r\n      if (!numericRegex.test(inputValue)) {\r\n        const filteredValue = inputValue.replace(/[^0-9]/g, '');\r\n        this.model.maSoThue = filteredValue;\r\n      }\r\n    },\r\n  },\r\n  watch: {\r\n    model: {\r\n      deep: true,\r\n      handler(val){\r\n        if (this.model.list != null && this.model.list.length > 0)\r\n        {\r\n          this.isDisabled = true ;\r\n          this.isShow = true;\r\n        }else {\r\n          this.isDisabled = false;\r\n          this.isShow = false\r\n        }\r\n      }\r\n    },\r\n    valueLoaiDichVuYTe: {\r\n      deep: true,\r\n      handler(val) {\r\n        if (!this.isUpdateList)\r\n        {\r\n          this.listThuoc = [];\r\n          this.modelThongTin = thongTinHangHoaModel.baseJson();\r\n          this.valueThuoc = null;\r\n          this.valueDonViTinh = null;\r\n\r\n          if (this.valueLoaiDichVuYTe != null && this.valueLoaiDichVuYTe.thuoc.length > 0 )\r\n          {\r\n            this.listThuoc = this.valueLoaiDichVuYTe.thuoc;\r\n          }\r\n        }else {\r\n          this.isUpdateList = false;\r\n        }\r\n      }\r\n    },\r\n    valueThuoc: {\r\n      deep: true,\r\n      handler(val) {\r\n        if ( this.valueThuoc != null && this.valueThuoc.donViTinhs.length  > 0)\r\n        {\r\n          // this.listDonViTinh = this.valueThuoc.donViTinhs;\r\n          this.modelThongTin.tenHangHoa = this.valueThuoc.name;\r\n          this.modelThongTin.donGia = this.valueThuoc.donGiaBanRa;\r\n          this.modelThongTin.phiTiem = this.valueThuoc.phiTiem;\r\n          this.modelThongTin.phiTuVan = this.valueThuoc.phiTuVan;\r\n          if (this.listDonViTinh.length > 0)\r\n          {\r\n            this.valueDonViTinh = this.listDonViTinh.at(0);\r\n          }\r\n        }\r\n      }\r\n    },\r\n    valueKhachHang:{\r\n      deep:true,\r\n      handler(){\r\n        if(this.valueKhachHang!=null){\r\n          this.$store.dispatch(\"khachHangStore/getById\", this.valueKhachHang).then((res) => {\r\n            if (res.code===0) {\r\n        //      console.log(res)\r\n              this.tempModel = khachHangModel.toJson(res.data);\r\n              this.model.tenDonVi=this.tempModel.tenDonVi\r\n              this.model.tenKhachHang=this.tempModel.tenKhachHang\r\n              this.model.maSoThue=this.tempModel.maSoThue\r\n              this.model.diaChi=this.tempModel.diaChi\r\n              this.model.taiKhoanNganHang=this.tempModel.taiKhoanNganHang\r\n              this.model.khachHang=this.tempModel.tenKhachHang\r\n            } else {\r\n              return;\r\n            }\r\n          });\r\n        }\r\n        else {\r\n          this.model.tenDonVi=null\r\n          this.model.tenKhachHang=null\r\n          this.model.maSoThue=null\r\n          this.model.diaChi=null\r\n          this.model.taiKhoanNganHang=null\r\n          this.model.khachHang=null\r\n        }\r\n\r\n      }\r\n    },\r\n    showDeleteModalNhap (val)\r\n    {\r\n        this.isDelete = true;\r\n    },\r\n    showModal(status) {\r\n      if (status == false) {\r\n        this.model = hoaDonModel.baseJson();\r\n      }else {\r\n        if (this.model.hinhThucThanhToan == null && this.listHinhThuc.length > 0 );\r\n        this.model.hinhThucThanhToan =  this.listHinhThuc.at(0);\r\n      }\r\n    },\r\n    showDeleteModal(val) {\r\n      if (val == false) {\r\n        this.model.id = null;\r\n        this.isDelete = true;\r\n        this.huyModel = deleteModel.baseJson();\r\n      }\r\n    },\r\n    'itemFilter.trangThai': {\r\n      deep: true,\r\n      handler(newvalue,oldvalue){\r\n        this.itemFilter.trangThai=newvalue\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<template>\r\n  <Layout>\r\n    <PageHeader :title=\"title\" :items=\"items\"/>\r\n    <div class=\"row\">\r\n      <div class=\"col-12\">\r\n        <div class=\"card\">\r\n          <div class=\"card-body\">\r\n            <div class=\"row\">\r\n              <div class=\"mb-3 col-lg-4\">\r\n                <label>Nội dung</label>\r\n                <input\r\n                    v-model=\"itemFilter.content\"\r\n                    size=\"sm\"\r\n                    type=\"text\"\r\n                    name=\"untyped-input\"\r\n                    class=\"form-control\"\r\n                    placeholder=\"Nhập tên khách hàng/ đơn vị/mã số thuế\"\r\n                />\r\n              </div>\r\n              <div class=\"mb-3 col-lg-4\">\r\n                <label>Hình thức thanh toán </label>\r\n                <multiselect v-model=\"itemFilter.hinhThucThanhToan\"\r\n                             label=\"name\"\r\n                             selectLabel=\"Nhấn vào để chọn\"\r\n                             deselectLabel=\"Nhấn vào để xóa\"\r\n                             :options=\"listHinhThuc.map((type) => type.id)\"\r\n                             :custom-label=\"\r\n                              (opt) => listHinhThuc.find((x) => x.id == opt).name\r\n                              \"\r\n                             placeholder=\"Chọn hình thức thanh toán\"\r\n                >\r\n                </multiselect>\r\n              </div>\r\n              <div class=\"mb-3 col-lg-4\">\r\n                <label>Người phát hành </label>\r\n                <multiselect v-model=\"itemFilter.userName\"\r\n                             label=\"fullName\"\r\n                             selectLabel=\"Nhấn vào để chọn\"\r\n                             deselectLabel=\"Nhấn vào để xóa\"\r\n                             :options=\"listNguoiPhatHanh\"\r\n                             placeholder=\"Chọn người phát hành\"\r\n                >\r\n                </multiselect>\r\n              </div>\r\n              <div class=\"mb-3 col-lg-4\">\r\n                <label>Trạng thái hóa đơn</label>\r\n                <multiselect v-model=\"itemFilter.trangThai\"\r\n                             label=\"name\"\r\n                             selectLabel=\"Nhấn vào để chọn\"\r\n                             deselectLabel=\"Nhấn vào để xóa\"\r\n                             :options=\"listTrangThai.map((type) => type.code)\"\r\n                             :custom-label=\"\r\n                              (opt) => listTrangThai.find((x) => x.code == opt).name\r\n                              \"\r\n                             placeholder=\"Chọn trạng thái hóa đơn\"\r\n\r\n                >\r\n                </multiselect>\r\n              </div>\r\n              <div class=\"mb-3 col-lg-4\">\r\n                <label>Thời gian bắt đầu</label>\r\n                <date-picker\r\n                    v-model=\"itemFilter.ngayBatDau\"\r\n                    format=\"DD/MM/YYYY\"\r\n                ></date-picker>\r\n              </div>\r\n              <div class=\"mb-3 col-lg-4\">\r\n                <label>Thời gian kết thúc</label>\r\n                <date-picker\r\n                    v-model=\"itemFilter.ngayKetThuc\"\r\n                    format=\"DD/MM/YYYY\"\r\n                    :disabled-date=\"disabledEndDate\"\r\n                    :disabled-time=\"disabledEndTime\"\r\n                ></date-picker>\r\n              </div>\r\n            </div>\r\n            <div class=\"row\">\r\n              <div class=\"col-12 text-center\">\r\n                <b-button variant=\"\"\r\n                          class=\"w-10 cs-btn-primary\"\r\n                          style=\"margin-right: 10px ; height: 30px ; width: 100px\"\r\n                          @click=\"handleSearch\"\r\n                          size=\"sm\"\r\n                >\r\n                  <i\r\n                      class=\"bx bx-search font-size-16 align-middle me-2\"\r\n                  ></i>\r\n                  Tìm kiếm\r\n                </b-button>\r\n                <b-button\r\n                    class=\"w-10 cs-btn-primary\"\r\n                    style=\"margin-right: 10px; height: 30px ; width: 100px\"\r\n                    @click=\"handleClear\"\r\n                    size=\"sm\"\r\n                >\r\n                  <i class=\"mdi mdi-replay font-size-16 align-middle me-2\"></i>\r\n                  Làm mới\r\n                </b-button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"row\">\r\n      <div class=\"col-12\">\r\n        <div class=\"card\">\r\n          <div class=\"card-body\">\r\n            <div class=\"row\">\r\n              <div class=\"col-sm-12\">\r\n                <div class=\"text-sm-end\">\r\n                  <b-modal\r\n                      v-model=\"showModal\"\r\n                      title=\"Thông tin\"\r\n                      title-class=\"text-black font-18\"\r\n                      body-class=\"p-1\"\r\n                      hide-footer\r\n                      centered\r\n                      no-close-on-backdrop\r\n                      size=\"xl\"\r\n                      class=\"modal-xl\"\r\n                  >\r\n                    <template #modal-header=\"{  }\">\r\n                      <div class=\"fw-bolder font-size-18\">THÔNG TIN HOÁ ĐƠN</div>\r\n                      <div class=\"text-end \">\r\n                        <b-button\r\n                            type=\"submit\"\r\n                            variant=\"\"\r\n                            @click=\"handleSubmitList\"\r\n                            class=\"ms-1 cs-btn-primary\"\r\n                        >Thêm\r\n                        </b-button>\r\n                        <b-button\r\n                            type=\"submit\"\r\n                            variant=\"\"\r\n                            @click=\"handleSendReplacementInvoiceFromDataAPI\"\r\n                            class=\"ms-1 cs-btn-primary\"\r\n                        >LẬP HÓA ĐƠN THAY THẾ\r\n                        </b-button>\r\n                        <b-button variant=\"light\"  class=\"ms-1\" @click = \"handleModalClose\">\r\n                          Đóng\r\n                        </b-button>\r\n                      </div>\r\n                    </template>\r\n                    <form  ref=\"formContainer\">\r\n                      <div class=\"row md-0\">\r\n                        <div class=\"col-md-6 md-0\" style=\"margin-bottom: -20px\">\r\n                          <div class=\"table-custom-srollbar-dt\">\r\n                            <b-table\r\n                                class=\"datatables\"\r\n                                :items=\"this.model.list\"\r\n                                :fields=\"fieldsModal\"\r\n                                striped\r\n                                bordered\r\n                                responsive=\"sm\"\r\n                                :current-page=\"currentPage\"\r\n                                :sort-by.sync=\"sortBy\"\r\n                                :sort-desc.sync=\"sortDesc\"\r\n                                :filter=\"filter\"\r\n                                :filter-included-fields=\"filterOn\"\r\n                                ref=\"tblListTable\"\r\n                                primary-key=\"id\"\r\n                            >\r\n                              <template v-slot:cell(donGia)=\"data\">\r\n                                {{formatPrice(data.item.donGia)}}\r\n                              </template>\r\n                              <template v-slot:cell(donViTinh)=\"data\">\r\n                                {{data.item.donViTinh.name}}\r\n                              </template>\r\n                              <template v-slot:cell(process)=\"data\">\r\n                                <button\r\n                                    type=\"button\"\r\n                                    size=\"sm\"\r\n                                    class=\"btn btn-outline btn-sm\"\r\n                                    v-on:click=\"handleShowDeleteModalTable(data.item)\">\r\n                                  <i class=\"fas fa-trash-alt text-danger me-1\"></i>\r\n                                </button>\r\n                              </template>\r\n                            </b-table>\r\n                          </div>\r\n                          <div class=\"money\" v-if=\"tongTien > 0\">\r\n                            <span class=\"font-weight-bold font-size-15\"> TỔNG TIỀN : </span>\r\n                            <span class=\"font-weight-bold font-size-15\"> {{formatNumber.FormatNumberShow(this.tongTien)}} VND</span>\r\n                          </div>\r\n                        </div>\r\n                        <div class=\"col-md-6 md-0\" style=\"margin-bottom: -20px\">\r\n                          <b-card style=\"background: #d8e7ff\">\r\n                            <div class=\"row mt-0\">\r\n                              <div class=\"col-12\">\r\n                                <div class=\"mb-2\">\r\n                                  <label class=\"text-left mb-0\">Chọn khách hàng</label>\r\n                                  <multiselect\r\n                                      v-model=\"valueKhachHang\"\r\n                                      label=\"tenKhachHang\"\r\n                                      selectLabel=\"Nhấn vào để chọn\"\r\n                                      deselectLabel=\"Nhấn vào để xóa\"\r\n                                      :options=\"listKhachHang.map((type) => type.id)\"\r\n                                      :custom-label=\"\r\n                              (opt) => listKhachHang.find((x) => x.id == opt).tenKhachHangShow\r\n                              \"\r\n                                      placeholder=\"Chọn khách hàng\"\r\n                                  >\r\n                                  </multiselect>\r\n                                </div>\r\n                              </div>\r\n                              <div class=\"col-6\">\r\n                                <div class=\"mb-2\">\r\n                                  <label class=\"text-left mb-0\">Hình thức thanh toán</label>\r\n                                  <multiselect v-model=\"model.hinhThucThanhToan\"\r\n                                               :options=\"listHinhThuc\"\r\n                                               label=\"name\"\r\n                                               selectLabel=\"Nhấn vào để chọn\"\r\n                                               deselectLabel=\"Nhấn vào để xóa\"\r\n                                               track-by=\"id\"\r\n                                               placeholder=\"Chọn hình thức thanh toán\"\r\n                                               :class=\"{\r\n                                                  'is-invalid':\r\n                                                (submitted  && $v.model.hinhThucThanhToan.$error) ,\r\n                                                }\"\r\n                                  >\r\n                                  </multiselect>\r\n                                  <div\r\n                                      v-if=\"submitted && !$v.model.hinhThucThanhToan.required\"\r\n                                      class=\"invalid-feedback\"\r\n                                  >\r\n                                    Vui lòng chọn hình thức thanh toán !\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n\r\n                              <div class=\"col-6\">\r\n                                <div class=\"mb-2\">\r\n                                  <label class=\"text-left mb-0\">Người mua hàng</label>\r\n                                  <!-- <input type=\"hidden\" v-model=\"model.id\" /> -->\r\n                                  <input\r\n                                      id=\"percent\"\r\n                                      v-model=\"model.tenKhachHang\"\r\n                                      type=\"text\"\r\n                                      class=\"form-control\"\r\n                                      :class=\"{\r\n                                        'is-invalid':\r\n                                      (submitted && $v.model.tenKhachHang.$error),\r\n                                      }\"\r\n\r\n                                  />\r\n                                  <div\r\n                                      v-if=\" (submitted && !$v.model.tenKhachHang.required)\"\r\n                                      class=\"invalid-feedback\"\r\n                                  >\r\n                                    Người mua hàng không được trống !\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                              <div class=\"col-6\">\r\n                                <div class=\"mb-2\">\r\n                                  <label class=\"text-left mb-0\">Tên đơn vị</label>\r\n                                  <input\r\n                                      id=\"percent\"\r\n                                      v-model=\"model.tenDonVi\"\r\n                                      type=\"text\"\r\n                                      class=\"form-control\"\r\n                                  />\r\n                                </div>\r\n                              </div>\r\n                              <div class=\"col-6\">\r\n                                <div class=\"mb-2\">\r\n                                  <label class=\"text-left mb-0\">Mã số thuế</label>\r\n                                  <!-- <input type=\"hidden\" v-model=\"model.id\" /> -->\r\n                                  <input\r\n\r\n                                      id=\"percent\"\r\n                                      v-model=\"model.maSoThue\"\r\n                                      type=\"text\"\r\n                                      @input=\"filterNonNumeric\"\r\n                                      class=\"form-control\"\r\n\r\n                                  />\r\n                                </div>\r\n                              </div>\r\n                              <div class=\"col-6\">\r\n                                <div class=\"mb-2\">\r\n                                  <label class=\"text-left mb-0\">Tài khoản ngân hàng</label>\r\n                                  <input\r\n                                      id=\"percent\"\r\n                                      v-model=\"model.taiKhoanNganHang\"\r\n                                      type=\"text\"\r\n                                      class=\"form-control\"\r\n\r\n                                  />\r\n                                </div>\r\n                              </div>\r\n                              <div class=\"col-6\">\r\n                                <div class=\"mb-2 \">\r\n                                  <label class=\"text-left mb-0\">Địa chỉ</label>\r\n                                  <input\r\n\r\n                                      id=\"percent\"\r\n                                      v-model=\"model.diaChi\"\r\n                                      type=\"text\"\r\n                                      class=\"form-control\"\r\n                                      :class=\"{\r\n                                        'is-invalid':\r\n                                      submitted && $v.model.diaChi.$error,\r\n                                      }\"\r\n                                  />\r\n                                  <div\r\n                                      v-if=\"submitted && !$v.model.diaChi.required\"\r\n                                      class=\"invalid-feedback\"\r\n                                  >\r\n                                    Địa chỉ không được trống !\r\n                                  </div>\r\n\r\n                                </div>\r\n                              </div>\r\n                              <div class=\"col-6\">\r\n                                <div class=\"mb-2\">\r\n                                  <label class=\"text-left mb-0\">Loại dịch vụ y tế</label>\r\n                                  <multiselect v-model=\"valueLoaiDichVuYTe\"\r\n                                               :options=\"listLoaiDichVu\"\r\n                                               label=\"name\"\r\n                                               selectLabel=\"Nhấn vào để chọn\"\r\n                                               deselectLabel=\"Nhấn vào để xóa\"\r\n                                               track-by=\"id\"\r\n                                               placeholder=\"Chọn loại dịch vụ y tế\"\r\n                                               :class=\"{\r\n                                                 'is-invalid':\r\n                                                 submitted && $v.valueLoaiDichVuYTe.$error,\r\n                                         }\"\r\n\r\n                                  >\r\n\r\n                                  </multiselect>\r\n                                  <div\r\n                                      v-if=\"submitted && !$v.valueLoaiDichVuYTe.required\"\r\n                                      class=\"invalid-feedback\"\r\n                                  >\r\n                                    Loại dịch vụ y tế không được để trống.\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                              <div class=\"col-6\">\r\n                                <div class=\"mb-2 \">\r\n                                  <label class=\"text-left mb-0\">Thuốc - Dịch vụ y tế</label>\r\n                                  <multiselect v-model=\"valueThuoc\"\r\n                                               :options=\"listThuoc\"\r\n                                               label=\"name\"\r\n                                               selectLabel=\"Nhấn vào để chọn\"\r\n                                               deselectLabel=\"Nhấn vào để xóa\"\r\n                                               track-by=\"id\"\r\n                                               placeholder=\"Chọn thuốc - dịch vụ y tế\"\r\n                                               :class=\"{\r\n                                                 'is-invalid':\r\n                                                 submitted && $v.valueThuoc.$error,\r\n                                         }\"\r\n\r\n                                  >\r\n                                  </multiselect>\r\n                                  <div\r\n                                      v-if=\"submitted && !$v.valueThuoc.required\"\r\n                                      class=\"invalid-feedback\"\r\n                                  >\r\n                                    Thuốc - Dịch vụ y tế không được để trống.\r\n                                  </div>\r\n\r\n                                </div>\r\n                              </div>\r\n                              <div class=\"col-6\">\r\n                                <div class=\"mb-2 \">\r\n                                  <label class=\"text-left mb-0\">Đơn vị tính</label>\r\n                                  <multiselect v-model=\"valueDonViTinh\"\r\n                                               :options=\"listDonViTinh\"\r\n                                               label=\"name\"\r\n                                               selectLabel=\"Nhấn vào để chọn\"\r\n                                               deselectLabel=\"Nhấn vào để xóa\"\r\n                                               track-by=\"id\"\r\n                                               placeholder=\"Chọn đơn vị tính\"\r\n                                               :class=\"{\r\n                                                 'is-invalid':\r\n                                                 submitted && $v.valueDonViTinh.$error,\r\n                                         }\"\r\n                                  >\r\n                                  </multiselect>\r\n                                  <div\r\n                                      v-if=\"submitted && !$v.valueDonViTinh.required\"\r\n                                      class=\"invalid-feedback\"\r\n                                  >\r\n                                    Đơn vị tính không được để trống.\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                              <div class=\"col-6\">\r\n                                <div class=\"mb-2 \">\r\n                                  <label class=\"text-left mb-0\">Tên hàng hoá</label>\r\n                                  <input\r\n                                      id=\"percent\"\r\n                                      v-model=\"modelThongTin.tenHangHoa\"\r\n                                      type=\"text\"\r\n                                      class=\"form-control\"\r\n                                      :class=\"{\r\n                                          'is-invalid':\r\n                                        submitted && $v.modelThongTin.tenHangHoa.$error,\r\n                                        }\"\r\n                                  />\r\n                                  <div\r\n                                      v-if=\"submitted && !$v.modelThongTin.tenHangHoa.required\"\r\n                                      class=\"invalid-feedback\"\r\n                                  >\r\n                                    Tên hàng hóa không được trống !\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                              <div class=\"col-6\">\r\n                                <div class=\"mb-2 \">\r\n                                  <label class=\"text-left mb-0\">Đơn giá</label>\r\n                                  <input\r\n                                      v-model.lazy=\"modelThongTin.donGia\"\r\n                                      v-money=\"money\"\r\n                                      class=\"form-control\"\r\n                                  />\r\n                                </div>\r\n                              </div>\r\n                              <div class=\"col-6\">\r\n                                <div class=\"mb-2 \">\r\n                                  <label class=\"text-left mb-0\">Số lượng</label>\r\n                                  <input\r\n                                      id=\"percent\"\r\n                                      v-model=\"modelThongTin.soLuong\"\r\n                                      type=\"number\"\r\n                                      class=\"form-control\"\r\n                                  />\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          </b-card>\r\n                        </div>\r\n                      </div>\r\n                    </form>\r\n                  </b-modal>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class=\"row\">\r\n              <div class=\"col-12\">\r\n                <div class=\"row\">\r\n                  <div class=\"col-sm-12 col-md-6\">\r\n                    <div class=\"col-sm-12 d-flex justify-content-left align-items-center\">\r\n                      <div class=\"m-1\" style=\"display: flex; justify-content: left; align-items: center;\">\r\n                        <div class=\"me-1\">Hiển thị</div>\r\n                        <b-form-select\r\n                            class=\"form-select form-select-sm\"\r\n                            v-model=\"perPage\"\r\n                            size=\"sm\"\r\n                            :options=\"pageOptions\"\r\n                            style=\"width: 70px\"\r\n                        ></b-form-select\r\n                        >&nbsp;\r\n                        <div style=\"width: 100px\"> dòng</div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div class=\"table-responsive mb-0\">\r\n                  <b-table\r\n                      class=\"datatables\"\r\n                      :items=\"myProvider\"\r\n                      :fields=\"fields\"\r\n                      striped\r\n                      bordered\r\n                      responsive=\"sm\"\r\n                      :per-page=\"perPage\"\r\n                      :current-page=\"currentPage\"\r\n                      :sort-by.sync=\"sortBy\"\r\n                      :sort-desc.sync=\"sortDesc\"\r\n                      :filter=\"filter\"\r\n                      :filter-included-fields=\"filterOn\"\r\n                      ref=\"tblList\"\r\n                      primary-key=\"id\"\r\n                  >\r\n                    <template v-slot:cell(STT)=\"data\">\r\n                      {{ data.index + ((currentPage - 1) * perPage) + 1 }}\r\n                    </template>\r\n                    <template v-slot:cell(chuyenDoi)=\"data\">\r\n                      <div>\r\n                        <input class=\"form-check-input\" type=\"checkbox\" v-model=\"data.item.chuyenDoi\" disabled=\"true\">\r\n                      </div>\r\n                    </template>\r\n                    <template v-slot:cell(statusName)=\"data\">\r\n                      <div >\r\n                         <span\r\n                             class=\"badge rounded-pill font-size-12 fw-bolder\"\r\n                             :class=\"{\r\n                             'badge-soft-dark': data.item.statusCode === 'DAXOA',\r\n                            'badge-soft-primary': data.item.statusCode === 'NHAP',\r\n                            'badge-soft-success': data.item.statusCode === 'DAPHATHANH',\r\n                             'badge-soft-danger': data.item.statusCode === 'THAYTHE',\r\n                          }\"\r\n                         >{{ data.item.statusName }}</span>\r\n                      </div>\r\n                    </template>\r\n                    <template v-slot:cell(process)=\"data\">\r\n                        <button\r\n                            type=\"button\"\r\n                                 size=\"sm\"\r\n                                 class=\"btn btn-outline btn-sm\"\r\n                                v-on:click=\"handleInvoiceFromData(data.item.id)\">\r\n                          <i class=\"fas fa-cloud-download-alt fa-lg text-sale me-1\"></i>\r\n                        </button>\r\n                    </template>\r\n\r\n                  </b-table>\r\n                </div>\r\n                <div class=\"row\">\r\n                  <b-col>\r\n                    <div>Hiển thị {{ numberOfElement }} trên tổng số {{ totalRows }} dòng</div>\r\n                  </b-col>\r\n                  <div class=\"col\">\r\n                    <div\r\n                        class=\"dataTables_paginate paging_simple_numbers float-end\">\r\n                      <ul class=\"pagination pagination-rounded mb-0\">\r\n                        <!-- pagination -->\r\n                        <b-pagination\r\n                            v-model=\"currentPage\"\r\n                            :total-rows=\"totalRows\"\r\n                            :per-page=\"perPage\"\r\n                        ></b-pagination>\r\n                      </ul>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <b-modal\r\n                    v-model=\"showPhatHanhModal\"\r\n                    centered\r\n                    title=\"Phát hành hóa đơn\"\r\n                    title-class=\"font-18\"\r\n                    no-close-on-backdrop\r\n                    hide-header-close\r\n                    size=\"lg\"\r\n                >\r\n                  <p>\r\n                    Bạn chắc chắn muốn phát hành hóa đơn này?\r\n                  </p>\r\n                  <template #modal-footer>\r\n                    <button v-b-modal.modal-close_visit\r\n                            class=\"btn btn-outline-info m-1\"\r\n                            v-show=\"isSend\"\r\n                            v-on:click=\"handleClosePhatHanh\">\r\n                      Đóng\r\n                    </button>\r\n                    <button v-b-modal.modal-close_visit\r\n                            class=\"btn btn-warning btn m-1\"\r\n                            v-show=\"isSend\"\r\n                            v-on:click=\"handleSendInvoiceFromDataAPI\">\r\n                      Phát hành\r\n                    </button>\r\n                  </template>\r\n                </b-modal>\r\n                <b-modal\r\n                    v-model=\"showDeleteModal\"\r\n                    centered\r\n                    title=\"Hủy hóa đơn\"\r\n                    title-class=\"font-18\"\r\n                    hide-header-close\r\n                    no-close-on-backdrop\r\n                >\r\n                  <div class=\"col-12\">\r\n                    <div class=\"mb-2 \">\r\n                      <label class=\"text-left mb-0\">Tên văn bản thỏa thuận hủy hóa đơn</label>\r\n                      <input\r\n                          type=\"text\"\r\n                          v-model=\"huyModel.vanban\"\r\n                          class=\"form-control\"\r\n                          :class=\"{\r\n                                        'is-invalid':\r\n                                      submittedHuy && $v.huyModel.vanban.$error,\r\n                                      }\"\r\n                      />\r\n                      <div\r\n                          v-if=\"submittedHuy && !$v.huyModel.vanban.required\"\r\n                          class=\"invalid-feedback\"\r\n                      >\r\n                        Văn bản thỏa thuận hủy hóa đơn không được trống !\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"col-12\">\r\n                    <div class=\"mb-2 \">\r\n                      <label class=\"text-left mb-0\">Lý do hủy hóa đơn</label>\r\n                      <input\r\n                          id=\"percent\"\r\n                          type=\"text\"\r\n                          v-model=\"huyModel.lydo\"\r\n                          class=\"form-control\"\r\n                          :class=\"{\r\n                                        'is-invalid':\r\n                                      submittedHuy && $v.huyModel.lydo.$error,\r\n                                      }\"\r\n                      />\r\n                      <div\r\n                          v-if=\"submittedHuy && !$v.huyModel.lydo.required\"\r\n                          class=\"invalid-feedback\"\r\n                      >\r\n                        Lý do hủy hóa đơn không được trống !\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <template #modal-footer>\r\n                    <button v-b-modal.modal-close_visit\r\n                            class=\"btn btn-outline-info m-1\"\r\n                            v-show=\"isDelete\"\r\n                            v-on:click=\"showDeleteModal = false\">\r\n                      Đóng\r\n                    </button>\r\n                    <button\r\n                        v-show=\"isDelete\"\r\n                        v-b-modal.modal-close_visit\r\n                            class=\"btn btn-danger btn m-1\"\r\n                            v-on:click=\"handleDeleteAPI\">\r\n                      Xóa\r\n                    </button>\r\n                  </template>\r\n                </b-modal>\r\n                <b-modal\r\n                    v-model=\"showDeleteModalNhap\"\r\n                    centered\r\n                    title=\"Xóa hóa đơn nháp\"\r\n                    title-class=\"font-18\"\r\n                    no-close-on-backdrop\r\n                >\r\n                  <p>\r\n                  Dữ liệu xóa sẽ không được phục hồi!\r\n                </p>\r\n                  <template #modal-footer>\r\n                    <button v-b-modal.modal-close_visit\r\n                            v-show=\"isDelete\"\r\n                            class=\"btn btn-outline-info m-1\"\r\n                            v-on:click=\"showDeleteModal = false\">\r\n                      Đóng\r\n                    </button>\r\n                    <button\r\n                        v-show=\"isDelete\"\r\n                        v-b-modal.modal-close_visit\r\n                        class=\"btn btn-danger btn m-1\"\r\n                        v-on:click=\"handleDeleteNhapAPI\">\r\n                      Xóa\r\n                    </button>\r\n                  </template>\r\n                </b-modal>\r\n                <b-modal\r\n                    v-model=\"showDeleteTableModal\"\r\n                    centered\r\n                    title=\"Xóa dữ liệu hóa đơn\"\r\n                    title-class=\"font-18\"\r\n                    no-close-on-backdrop\r\n                >\r\n                  <p>\r\n                    Dữ liệu hóa đơn xóa sẽ không được phục hồi!\r\n                  </p>\r\n                  <template #modal-footer>\r\n                    <button v-b-modal.modal-close_visit\r\n                            class=\"btn btn-outline-info m-1\"\r\n                            v-on:click=\"handleClose\">\r\n                      Đóng\r\n                    </button>\r\n                    <button v-b-modal.modal-close_visit\r\n                            class=\"btn btn-danger btn m-1\"\r\n                            v-on:click=\"handleDeleteModal\">\r\n                      Xóa\r\n                    </button>\r\n                  </template>\r\n                </b-modal>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </Layout>\r\n</template>\r\n<style>\r\n\r\n.modal-dialog {\r\n  max-width: 97%;\r\n  height: 100vh;\r\n  display: flex;\r\n}\r\n\r\n.table-custom-srollbar-dt\r\n{\r\n  height: 460px;\r\n  background: #ffffff;\r\n  width: 100%;\r\n  overflow: auto;\r\n}\r\n\r\n</style>\r\n"]}]}